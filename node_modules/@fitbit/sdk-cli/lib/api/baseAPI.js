"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
const tslib_1 = require("tslib");
const auth = tslib_1.__importStar(require("../auth"));
const environment_1 = tslib_1.__importDefault(require("../auth/environment"));
const fetchUtil_1 = require("../util/fetchUtil");
exports.decodeJSON = fetchUtil_1.decodeJSON;
async function apiFetch(path, init = {}) {
    const authToken = await auth.getAccessToken();
    if (!authToken)
        throw new Error(`Fetch of ${path} failed: no stored auth token`);
    const headers = new Headers(init.headers || {});
    headers.set('authorization', `Bearer ${authToken}`);
    const mergedInit = Object.assign({ cache: 'no-store' }, init, { headers });
    return fetch(`${environment_1.default().config.apiUrl}/${path}`, mergedInit);
}
exports.apiFetch = apiFetch;
