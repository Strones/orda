"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
const jsonrpc_ts_1 = require("@fitbit/jsonrpc-ts");
exports.assertOK = (response) => response.ok ?
    Promise.resolve(response) :
    Promise.reject(new Error(`Fetch of ${response.url} returned status ${response.status} ${response.statusText}`));
exports.assertContentType = (expected) => (response) => {
    const contentTypeHeader = response.headers.get('content-type') || '';
    const contentType = contentTypeHeader.split(';', 1)[0];
    if (contentType !== expected) {
        return Promise.reject(new Error(`Unexpected Content-Type: expected '${expected}', got '${contentType}'`));
    }
    return Promise.resolve(response);
};
exports.assertJSON = (expected = 'application/json') => async (response) => {
    await exports.assertContentType(expected)(response);
    return response.json();
};
exports.decodeJSON = (endpointType) => (response) => exports.assertOK(response)
    .then(exports.assertJSON())
    .then(jsonrpc_ts_1.decode(endpointType));
