"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
const tslib_1 = require("tslib");
const debuggerHost = tslib_1.__importStar(require("../models/debuggerHost"));
function mockHost(cli) {
    let socket;
    async function mockHostAction(hostType, args) {
        const maxAPIVersion = args.options.maxAPIVersion;
        socket = await debuggerHost.createHostConnection(hostType);
        return debuggerHost.createDebuggerHost(socket, hostType, msg => cli.activeCommand.log(msg), { maxAPIVersion });
    }
    const hostTypes = ['app', 'companion'];
    for (const hostType of hostTypes) {
        cli
            .command(`mock-host ${hostType}`, `Create a fake developer bridge ${hostType} host (for testing)`)
            .option('--maxAPIVersion <version>', 'Set the advertised max API version')
            .action(args => mockHostAction(hostType, args))
            .cancel(() => {
            if (socket)
                socket.close();
        });
    }
}
exports.default = mockHost;
