"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
const tslib_1 = require("tslib");
const path_1 = require("path");
const stream_1 = require("stream");
const rollup = tslib_1.__importStar(require("rollup"));
const vinyl_1 = tslib_1.__importDefault(require("vinyl"));
function rollupToVinyl(outputPath, inputOptions, outputOptions) {
    const stream = new stream_1.Readable({ objectMode: true });
    stream._read = () => { };
    rollup.rollup(inputOptions).then((bundle) => {
        stream.emit('bundle', bundle);
        return bundle.generate(outputOptions).then(({ code, map }) => {
            stream.push(new vinyl_1.default({
                contents: Buffer.from(code, 'utf8'),
                path: path_1.resolve(process.cwd(), outputPath),
                sourceMap: map,
            }));
            stream.push(null);
        });
    }).catch((reason) => {
        setImmediate(() => stream.emit('error', reason));
    });
    return stream;
}
exports.default = rollupToVinyl;
